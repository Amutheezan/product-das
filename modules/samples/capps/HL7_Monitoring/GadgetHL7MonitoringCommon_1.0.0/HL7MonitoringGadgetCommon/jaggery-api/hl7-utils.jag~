<%
function isNull(value){
  var isNull=false;
  if(typeof value === "undefined" || value === null || value === "" || value === "null"){
    isNull=true;
  }
	if(typeof value == "undefined" || value == null || value == "" || value == "null"){
		isNull=true;
	}
  return isNull;
}

function getAlertLimit(executionPlan){
	var alertLimit;
	if(isNull(executionPlan) == false ){
    executionPlan=executionPlan.split(" ");
    for(var i=0;i<executionPlan.length;i++){
      if(executionPlan[i] == ">"){
        alertLimit= executionPlan[i+1];
      }
    }
	}
	return alertLimit;
}

function getPhoneNo(smsPublisher){
	var phoneNo;
	if(isNull(smsPublisher) == false ){
    log.info(smsPublisher);
    var regexGetPhoneNo=/<property name="sms.no">(.*?)<\/property>/g;
		phoneNo=smsPublisher.match(regexGetPhoneNo).map(function(val){
      val = val.replace('<property name="sms.no">','');
      val = val.replace('</property>','');
      val = val.replace(' ','');
      return val
    })
	}
	return phoneNo;
}

function getEmailAddress(emailPublisher){
	var Email;
	if(isNull(emailPublisher) == false ){
      var regexGetEmail=/<property name="email.address">(.*?)<\/property>/g;
      Email=emailPublisher.match(regexGetEmail).map(function(val){
      val = val.replace('<property name="email.address">','');
      val = val.replace('</property>','');
      val = val.replace(' ','');
        return val
      })
	}
	return Email;
}

function getFile(path){
  var file = new File(path);
  file.open("r");
  var message = "";
  message = file.readAll();
  file.close();
  return message;
}

function createExecutionPlan(AlertType){
  var ExecutionPlan,file;
  if(AlertType != "disease" && AlertType != "waitTime"){

  }else{
    if(AlertType == "disease"){
		  ExecutionPlan=getFile("executionPlans/waitTimeAlerts.siddhiql");
    }else if(AlertType == "waitTime"){
      ExecutionPlan=getFile(diseaseAlerts.siddhiql);
    }
		  log.info(ExecutionPlan + " is the executionplan");
  }
	return ExecutionPlan;
}

function createPublisher(AlertType,PublisherType){
  var publisher,file;
  if(PublisherType != "sms" && PublisherType != "email"){

  }else{

    if(PublisherType == "sms"){
        publisher=getFile("smsPublisher.xml");
    }else if (PublisherType == "email"){
       publisher=getFile("emailPublisher.xml");
    }
    publisher = publisher.replace('$AlertType',AlertType);
  }

	return publisher
}


%>
